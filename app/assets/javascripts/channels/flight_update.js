App.flight_update = App.cable.subscriptions.create('FlightUpdateChannel', {
  connected: function () {
    console.log('connected')
  },
  disconnected: function () {
    console.log('disconnected')
  },
  received: function (data) {
    var flight_data = data.content
    var user_data = data.user

    if(data.method === 'create') {
      createFlightCard(flight_data)
    } else {
      bookFlight(flight_data, user_data)
    }
  }
})

function bookFlight(flight_data, user_data) {
  console.log(flight_data);
  console.log(gon.current_user, user_data)

  if(gon.current_user === flight_data.user) {
    var $target = $('#flight' + flight_data.id)
    $target.find('.card').addClass('booked')
    $target.find('footer').remove()
  }
}

function createFlightCard(flight_data) {
  var $target = $('#flight-list')
  // creation of the div
  var $new_flight_div = $('<div id="flight' + flight_data.id + '" class="column is-one-quarter">')
  var $new_flight_card = $('<div class="card">')
  var $new_flight_card_content = $('<div class="card-content">')
  var $new_flight_p_title = $('<p class="title">')
  var $new_flight_p_subtitle = $('<p class="subtitle">')
  var $new_flight_footer = $('<footer class="card-footer">')
  var $new_flight_footer_viewlink = $('<a href="/flights/' + flight_data.id + '" class="card-footer-item">View</a>')
  var $new_flight_footer_booklink = $('<a href="/book/' + flight_data.id + '" class="card-footer-item">Book</a>')

  // populating the body inside the div (title and subtitle)
  $new_flight_p_title.text(flight_data.from + ' - ' + flight_data.to)
  $new_flight_p_subtitle.text(flight_data.airline + '(' + flight_data.num_passenger + ' pax)')

  // appending the div into the card structure
  $new_flight_card_content.append($new_flight_p_title)
  $new_flight_card_content.append($new_flight_p_subtitle)
  $new_flight_footer.append($new_flight_footer_viewlink)
  $new_flight_footer.append($new_flight_footer_booklink)

  $new_flight_card.append($new_flight_card_content)
  $new_flight_card.append($new_flight_footer)

  $new_flight_div.append($new_flight_card)

  // append that to the targeted div (#flight-list)
  $target.append($new_flight_div)
  $('input[type=submit]').prop('disabled', false)
}

// ---
// generated by coffee-script 1.9.2
